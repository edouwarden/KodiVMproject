d-i keyboard-configuration/xkb-keymap select fr

d-i debconf/priority string critical
d-i debconf/language string fr
d-i debconf/country string FR
d-i debconf/locale string fr_FR.UTF-8

d-i debian-installer/locale string fr_FR

d-i netcfg/choose_interface select auto
d-i netcfg/dhcp_timeout string 60

d-i passwd/root-password password rootpassword
d-i passwd/root-password-again password rootpassword

tasksel tasksel/first multiselect standard
d-i pkgsel/include string openssh-server kodi unzip kodi-eventclients-kodi-send xserver-xorg-legacy
d-i pkgsel/upgrade select safe-upgrade
d-i grub-installer/only_debian boolean true

d-i time/zone string Europe/Paris
d-i clock-setup/utc boolean true
d-i clock-setup/ntp boolean true

d-i passwd/user-fullname string kodi
d-i passwd/user-uid string 1000
d-i passwd/username string kodi
d-i passwd/user-password-crypted password !
d-i passwd/disable-login boolean true
d-i passwd/user-default-groups string cdrom audio video plugdev users dialout dip input netdev
d-i user-setup/allow-password-weak boolean true
d-i user-setup/encrypt-home boolean false
d-i user-setup/autologin boolean true

d-i partman-auto/disk string /dev/sda
d-i partman-auto/method string regular
d-i partman-auto/purge_lvm_from_device boolean true
d-i partman-auto/choose_recipe select multi
d-i partman-auto/expert_recipe string                                         \
      boot-kodi ::                                                            \
              250 250 250 ext2                                \
                      $primary{ } $bootable{ }                \
                      method{ format } format{ }              \
                      use_filesystem{ } filesystem{ ext2 }    \
                      mountpoint{ /boot }                     \
              .                                               \
              100% 2048 100% linux-swap                       \
                      lv_name{ swap }                         \
                      method{ swap } format{ }                \
                      $lvmok{ }                               \
              .                                               \
              500 1536 1536 ext3                                        \
                      method{ format } format{ }                              \
                      use_filesystem{ } filesystem{ ext3 }                    \
                      mountpoint{ / }                                         \
              .                                                               \
              500 500 500 ext3                                               \
                      method{ format } format{ }                              \
                      use_filesystem{ } filesystem{ ext3 }                    \
                      mountpoint{ /log }                                      \
              .                                                               \
              500 500 500 ext3                                             \
                      method{ format } format{ }                              \
                      use_filesystem{ } filesystem{ ext3 }                    \
                      mountpoint{ /home/kodi/.kodi/temp }                     \
              .                                                               \
              1024 1024 -1 xfs                                \
                      lv_name{ data }                         \
                      method{ lvm } format{ }                 \
                      use_filesystem{ } filesystem{ xfs }     \
                      mountpoint{ /home/kodi }                     \
                      $lvmok{ }                               \
              .
d-i     partman-partitioning/confirm_write_new_label boolean true
d-i     partman/choose_partition select finish
d-i     partman/confirm boolean true
d-i     partman/confirm_nooverwrite boolean true

d-i preseed/late_command string \
    echo "0 2-5 * * * root apt update && apt upgrade -y" >> /etc/crontab; \
    apt update && apt upgrade -y;
d-i preseed/late_command string \
    systemctl disable display-manager.service;\
    dpkg-reconfigure xserver-xorg-legacy;\
    echo "needs_root_rights=yes" >> /etc/X11/Xwrapper.config;
d-i preseed/late_command string \
    /usr/bin/xinit /usr/bin/dbus-launch --exit-with-session /usr/bin/kodi-standalone -- :0 -nolisten tcp vt7;\
    echo "[Unit]\
    Description = Kodi Media Center\
    After = systemd-user-sessions.service network.target sound.target\
    [Service] \
    User = kodi \
    Group = kodi \
    Type = simple \
    ExecStart = /usr/bin/xinit /usr/bin/dbus-launch --exit-with-session /usr/bin/kodi-standalone -- :0 -nolisten tcp vt7 \
    Restart = on-abort \
    RestartSec = 5 \
    [Install] \
    WantedBy = multi-user.target"> /etc/systemd/system/kodi.service; 
d-i preseed/late_command string \
    systemctl enable kodi.service; \
    echo "[Actions for kodi user] \
    Identity=unix-user:kodi \
    Action=org.freedesktop.upower.*;org.freedesktop.consolekit.system.*;org.freedesktop.udisks.*;org.freedesktop.login1.* \
    ResultAny=yes \
    ResultInactive=yes \
    ResultActive=yes" > /etc/polkit-1/localauthority/50-local.d/custom-actions.pkla;\
    echo "[Seat:*] \
    autologin-user=kodi \
    autologin-session=kodi" >> /etc/lightdm/lightdm.conf; 
d-i preseed/late_command string \
    apt remove --purge; \
    apt autoremove -y;
d-i preseed/late_command string \
    apt install kodi-eventclients-kodi-send; \
    kodi-send --action="{\"jsonrpc\":\"2.0\",\"method\":\"Files.AddVideosource\",\"params\":{\"name\":\"Serveur Kodi\",\"path\":\"https://kodi.majyx.net/\",\"username\":\"student\",\"password\":\"student\"},\"id\":1}";

d-i finish-install/reboot_in_progress note